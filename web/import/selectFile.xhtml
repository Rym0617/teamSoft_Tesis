<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<!--by jpinas-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
>
    <h:form id="formF">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-fluid">
                <p:fieldset id="fieldsetF"> <!--esto pone un fondo blanco-->
                    <br/>
                    <!--                    primera fila donde esta el camino del fichero y el btn actionImportar-->
                    <div class="ui-g-12">
                        <p:outputLabel value="#{bundle.path_to_file_to_import}"/>

                        <p:fileUpload fileUploadListener="#{i_StepReadFileController.handleFileUpload}" mode="advanced"
                                      dragDropSupport="true" cancelLabel="#{bundle.label_select_file_cancel}"
                                      uploadLabel="#{bundle.label_select_file_select}"
                                      invalidFileMessage="#{bundle.error_file_type}"
                                      invalidSizeMessage="#{bundle.error_file_size}"
                                      fileLimitMessage="#{bundle.error_file_count}"
                                      label="#{bundle.label_select_file_search}" update="@all"
                                      sizeLimit="10000000"
                                      fileLimit="1"
                                      allowTypes="/(\.|\/)(csv)$/"
                                      auto="true"
                                      accept=""
                        />
                    </div>
                    <br/>
                    <div class="ui-g-6 ui-fluid">
                        <h:outputLabel for="groupName"
                                       value="#{bundle.group_name}"
                                       rendered="#{not empty stepFileUploadController.dataList}"/>
                        <p:selectOneMenu id="groupName"
                                         editable="true"
                                         placeholder="#{bundle.place_holder_group_name}"
                                         value="#{i_StepReadFileController.selectedPersonGroup}"
                                         filter="true"
                                         filterMatchMode="contains"
                                         required="true"
                                         requiredMessage="#{bundle.required_message_group_name}"
                                         rendered="#{not empty stepFileUploadController.dataList}"
                        >
                            <f:selectItems value="#{i_StepReadFileController.getPersonsGroupList()}"
                                           var="group"
                                           itemValue="#{group.name}"
                                           itemLabel="#{group.name}"
                            />
                            <p:ajax event="change"
                                    listener="#{i_StepReadFileController.setSelectedPersonGroup(group.name)}"/>
                            <p:ajax event="itemSelect"
                                    listener="#{i_StepReadFileController.setSelectedPersonGroup(group.name)}"/>
                        </p:selectOneMenu>
                    </div>

                    <div class="ui-g-12 ui-fluid">
                        <!--reflow se encarga de arreglar la visual cuando se pone en modo movil-->
                        <p:dataTable id="tableDataF" var="item" emptyMessage="#{bundle.empty_table_message}"
                                     value="#{i_StepReadFileController.dataList}"
                                     paginator="true"
                                     rows="5"
                                     rowsPerPageTemplate="5,10,20"
                                     paginatorAlwaysVisible="false"
                                     rowIndexVar="fila"
                                     reflow="true"
                                     rendered="#{not empty stepFileUploadController.dataList}"
                        >
                            <f:facet name="header">
                                <p:outputLabel value="#{bundle.file_content}"/>
                            </f:facet>

                            <p:columnGroup type="header">
                                <p:row>
                                    <ui:repeat value="#{i_StepReadFileController.encabezadoList}" var="header"
                                               varStatus="status">
                                        <p:column
                                                headerText="#{i_StepReadFileController.getEncabezadoByPos(status.index)}"/>
                                    </ui:repeat>
                                </p:row>
                            </p:columnGroup>

                            <p:columns value="#{i_StepReadFileController.indexList}" var="columna">
                                <h:outputText value="#{i_StepReadFileController.getValue(fila, columna)}"/>
                            </p:columns>


                            <f:facet name="footer">
                                In total there are #{fn:length(i_StepReadFileController.dataList)} persons.
                            </f:facet>
                        </p:dataTable>
                    </div>
                </p:fieldset>
            </div>
        </div>
    </h:form>

</ui:composition>