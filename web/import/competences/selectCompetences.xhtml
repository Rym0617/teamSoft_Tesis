<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<!--by jpinas-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
>
    <script type="text/javascript">
        function handleDrop(event, ui) {
            var droppedCar = ui.draggable;
            droppedCar.fadeOut('fast');
        }
    </script>

    <h:form id="formC">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-fluid">
                <p:fieldset id="fldsetC"> <!--esto pone un fondo blanco-->
                    <p:outputLabel
                            value="#{bundle.text_help_competences}"/>
                    <div class="ui-g-12 ui-fluid">
                        <div class="ui-g-6">
                            <p:fieldset id="fldsetDisponiblesC" legend="#{bundle.table_disponibles_legend}">
                                <p:dataTable id="tableDisponibleC" var="atr"
                                             value="#{stepSelectCompetencesController.atributosDisponibles}"
                                             paginator="true"
                                             rows="5"
                                             reflow="true"
                                             rowsPerPageTemplate="5,10,20"
                                             paginatorAlwaysVisible="false"
                                >
                                    <f:facet name="header">
                                        <p:outputLabel value="#{bundle.table_disponibles_header}"/>
                                    </f:facet>

                                    <p:column style="width:20px">
                                        <p:outputLabel id="dragIcon" styleClass="fa-envelope"/>
                                        <p:draggable for="dragIcon" revert="true" helper="clone"/>
                                    </p:column>

                                    <p:column headerText="#{bundle.table_disponibles_column_header}">
                                        <h:outputText value="#{atr}"/>
                                    </p:column>

                                    <p:column headerText="#{bundle.table_disponibles_column_header_type}">
                                        <h:outputText value="#{stepUtils.getClassByAtribute(atr)}"/>
                                    </p:column>

                                </p:dataTable>
                            </p:fieldset>
                        </div>

                        <div class="ui-g-6">
                            <p:fieldset id="fldsetAsignadosC" legend="#{bundle.table_asignados_legend}"
                                        style="margin-top:20px">
                                <p:outputPanel id="dropAreaC">
                                    <h:outputText value="#{bundle.label_drop_here}"
                                                  rendered="#{empty stepSelectCompetencesController.atributosAsignados}"
                                                  style="font-size:24px;"/>
                                    <p:dataTable id="tableSelectedC" var="atribute"
                                                 value="#{stepSelectCompetencesController.atributosAsignados}"
                                                 editable="true"
                                                 editMode="cell"
                                                 reflow="true"
                                                 rendered="#{not empty stepSelectCompetencesController.atributosAsignados}"
                                    >
                                        <f:facet name="header">
                                            <p:outputLabel value="#{bundle.table_asignados_header_competencias}"/>
                                        </f:facet>

                                        <p:columnGroup type="header">
                                            <p:row>
                                                <p:column colspan="2"
                                                          headerText="#{bundle.table_asignados_column_header_atributo}"/>
                                                <p:column id="campoCompetencia">
                                                    <f:facet name="header">
                                                        <h:outputText
                                                                value="#{bundle.competence_type}"/>
                                                        <p:tooltip
                                                                value="#{bundle.table_column_tooltip_campo_competencia}"
                                                                for="campoCompetencia"
                                                                position="top"/>
                                                    </f:facet>
                                                </p:column>

                                                <p:column/>
                                            </p:row>
                                        </p:columnGroup>

                                        <p:column>
                                            <h:outputText value="#{atribute.fileAtribute}"/>
                                        </p:column>

                                        <p:column>
                                            <h:outputText
                                                    value="#{stepUtils.getClassByAtribute(atribute.fileAtribute)}"/>
                                        </p:column>

                                        <p:column>
                                            <p:cellEditor>
                                                <f:facet name="output">
                                                    <h:outputText value="#{atribute.getCompetencesAsString()}"/>
                                                </f:facet>
                                                <f:facet name="input">

                                                    <p:selectCheckboxMenu style="margin-bottom: 20px" id="groupMenu"
                                                                          value="#{stepSelectCompetencesController.atributosAsignados.get(
                                                                          stepSelectCompetencesController.atributosAsignados.indexOf(atribute)
                                                    ).competences}"
                                                                          filter="true" filterMatchMode="contains"
                                                                          label="Selecciona"
                                                                          panelStyle="width:250px">
                                                        <f:selectItems
                                                                value="#{stepSelectCompetencesController.competenceList}"
                                                                var="competences"
                                                                itemLabel="#{competences.competitionName}"
                                                                itemValue="#{competences.competitionName}"/>
                                                    </p:selectCheckboxMenu>

                                                </f:facet>
                                            </p:cellEditor>
                                        </p:column>

                                        <p:column style="width:32px;text-align: center">
                                            <p:commandButton
                                                    actionListener="#{stepSelectCompetencesController.removeAtribute(atribute)}"
                                                    icon="ui-icon-delete"
                                                    update="@all"
                                            />
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>
                            </p:fieldset>

                            <p:droppable for="fldsetAsignadosC" tolerance="touch" activeStyleClass="ui-state-highlight"
                                         datasource="tableDisponibleC" onDrop="handleDrop">
                                <p:ajax listener="#{stepSelectCompetencesController.onDrop}"
                                        update="@all"/>
                            </p:droppable>
                        </div>
                    </div>
                </p:fieldset>
            </div>
        </div>
    </h:form>
</ui:composition>