<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<!--by jpinas-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core"
>
    <script type="text/javascript">
        function handleDrop(event, ui) {
            var droppedCar = ui.draggable;
            droppedCar.fadeOut('fast');
        }
    </script>

    <h:form id="formR">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-fluid">
                <p:fieldset id="fldsetR"> <!--esto pone un fondo blanco-->
<!--                    <div class="ui-g-6 ui-fluid">-->
<!--                        <p:panelGrid columns="2" layout="grid" styleClass="ui-noborder">-->
<!--                            <h:outputLabel for="basic" value="#{bundle.label_numero_anos}"/>-->
<!--                            <p:spinner id="basic" value="#{stepSelectRolesController.anosMaxim}" min="0" max="60">-->
<!--                                <p:ajax update="basic"/>-->
<!--                            </p:spinner>-->
<!--                        </p:panelGrid>-->
<!--                    </div>-->

                    <div class="ui-g-12 ui-fluid">
                        <div class="ui-g-6 ui-fluid">
                            <p:fieldset id="fldsetDisponiblesR" legend="#{bundle.table_disponibles_legend}">
                                <p:dataTable id="tableDisponibleR" var="atr"
                                             value="#{stepSelectRolesController.atributosDisponibles}"
                                             paginator="true"
                                             rows="5"
                                             reflow="true"
                                             rowsPerPageTemplate="5,10,20"
                                             paginatorAlwaysVisible="false"
                                >
                                    <f:facet name="header">
                                        <p:outputLabel value="#{bundle.table_disponibles_header}"/>
                                    </f:facet>

                                    <p:column style="width:20px">
                                        <p:outputLabel id="dragIcon" styleClass="fa-envelope"/>
                                        <p:draggable for="dragIcon" revert="true" helper="clone"/>
                                    </p:column>

                                    <p:column headerText="#{bundle.table_disponibles_column_header}">
                                        <h:outputText value="#{atr}"/>
                                    </p:column>

                                    <p:column headerText="#{bundle.table_disponibles_column_header_type}">
                                        <h:outputText value="#{stepUtils.getClassByAtribute(atr)}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:fieldset>
                        </div>

                        <div class="ui-g-6 ui-fluid">
                            <p:fieldset id="fldsetAsignadosR" legend="#{bundle.table_asignados_legend}"
                                        style="margin-top:20px">
                                <p:outputPanel id="dropAreaR">
                                    <h:outputText value="#{bundle.label_drop_here}"
                                                  rendered="#{empty stepSelectRolesController.atributosAsignados}"
                                                  style="font-size:24px;"/>
                                    <p:dataTable id="tableSelectedR" var="atribute"
                                                 value="#{stepSelectRolesController.atributosAsignados}"
                                                 editable="true"
                                                 editMode="cell"
                                                 reflow="true"
                                                 rendered="#{not empty stepSelectRolesController.atributosAsignados}"
                                    >
                                        <f:facet name="header">
                                            <p:outputLabel value="#{bundle.table_rolesAsignados_header}"/>
                                        </f:facet>

                                        <p:columnGroup type="header">
                                            <p:row>
                                                <p:column colspan="2"
                                                          headerText="#{bundle.table_asignados_column_header_atributo}"/>
                                                <p:column id="campoRol">
                                                    <f:facet name="header">
                                                        <h:outputText
                                                                value="#{bundle.label_role}"/>
                                                        <p:tooltip
                                                                value="#{bundle.table_column_tooltip_campo_competencia}"
                                                                for="campoRol"
                                                                position="top"/>
                                                    </f:facet>
                                                </p:column>

                                                <p:column/>
                                            </p:row>
                                        </p:columnGroup>

                                        <p:column>
                                            <h:outputText value="#{atribute.fileAtribute}"/>
                                        </p:column>

                                        <p:column>
                                            <h:outputText
                                                    value="#{stepUtils.getClassByAtribute(atribute.fileAtribute)}"/>
                                        </p:column>

                                        <p:column>
                                            <p:cellEditor>
                                                <f:facet name="output">
                                                    <p:outputLabel value="#{atribute.getRoleName()}"/>
                                                </f:facet>
                                                <f:facet name="input">
                                                    <p:selectOneMenu style="margin-bottom: 20px"
                                                                     id="selectOneR"
                                                                     label="Selecciona"
                                                                     value="#{atribute.rol}"
                                                                     filter="true" filterMatchMode="contains"
                                                                     panelStyle="width:250px"
                                                    >
                                                        <f:selectItem noSelectionOption="true"
                                                                      itemLabel="Selecciona"
                                                                      itemValue=""
                                                        />
                                                        <f:selectItems
                                                                value="#{stepSelectRolesController.rolesAMostrar}"
                                                                var="r"
                                                                itemLabel="#{r.roleName}"
                                                                itemValue="#{r}"
                                                        />
                                                        <p:ajax listener="#{stepSelectRolesController.checkRoleSelected}"
                                                                update="selectOneR"
                                                        />
                                                    </p:selectOneMenu>
                                                </f:facet>
                                            </p:cellEditor>
                                        </p:column>

                                        <p:column style="width:32px;text-align: center">
                                            <p:commandButton
                                                    actionListener="#{stepSelectRolesController.removeAtribute(atribute)}"
                                                    icon="ui-icon-delete"
                                                    update="@all"
                                            >
                                            </p:commandButton>
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>
                            </p:fieldset>

                            <p:droppable for="fldsetAsignadosR" tolerance="touch" activeStyleClass="ui-state-highlight"
                                         datasource="tableDisponibleR" onDrop="handleDrop">
                                <p:ajax listener="#{stepSelectRolesController.onDrop}"
                                        update="@all"/>
                            </p:droppable>
                        </div>
                    </div>
                </p:fieldset>
            </div>
        </div>
    </h:form>
</ui:composition>