<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<!--by jpinas-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
>
    <script type="text/javascript">
        function handleDrop(event, ui) {
            var droppedCar = ui.draggable;
            droppedCar.fadeOut('fast');
        }
    </script>

    <h:form id="formP">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-fluid">
                <p:fieldset id="fldsetP"> <!--esto pone un fondo blanco-->
                    <p:outputLabel value="#{bundle.text_help_personas}"/>
                    <div class="ui-g-12 ui-fluid">
                        <div class="ui-g-6">
                            <p:fieldset id="fldsetDisponiblesP" legend="#{bundle.table_disponibles_legend}">
                                <p:dataTable id="tableDisponibleP" var="atr"
                                             value="#{stepSelectPersonController.atributosDisponibles}"
                                             paginator="true"
                                             rows="5"
                                             reflow="true"
                                             rowsPerPageTemplate="5,10,20"
                                             paginatorAlwaysVisible="false"
                                >
                                    <f:facet name="header">
                                        <p:outputLabel value="#{bundle.table_disponibles_header}"/>
                                    </f:facet>

                                    <p:column style="width:20px">
                                        <p:outputLabel id="dragIcon" styleClass="fa-envelope"/>
                                        <p:draggable for="dragIcon" revert="true" helper="clone"/>
                                    </p:column>

                                    <p:column headerText="#{bundle.table_disponibles_column_header}">
                                        <h:outputText value="#{atr}"/>
                                    </p:column>

                                    <p:column headerText="#{bundle.table_disponibles_column_header_type}">
                                        <h:outputText value="#{stepUtils.getClassByAtribute(atr)}"/>
                                    </p:column>

                                </p:dataTable>
                            </p:fieldset>
                        </div>

                        <div class="ui-g-6">
                            <p:fieldset id="fldsetAsignadosP" legend="#{bundle.table_asignados_legend}"
                                        style="margin-top:20px">
                                <p:outputPanel id="dropAreaP">
                                    <h:outputText value="#{bundle.label_drop_here}"
                                                  rendered="#{empty stepSelectPersonController.atributosAsignados}"
                                                  style="font-size:24px;"/>
                                    <p:dataTable id="tableSelectedP" var="atribute"
                                                 value="#{stepSelectPersonController.atributosAsignados}"
                                                 editable="true"
                                                 editMode="cell"
                                                 reflow="true"
                                                 rendered="#{not empty stepSelectPersonController.atributosAsignados}"
                                    >
                                        <f:facet name="header">
                                            <p:outputLabel value="#{bundle.table_asignados_header}"/>
                                        </f:facet>

                                        <p:columnGroup type="header">
                                            <p:row>
                                                <p:column colspan="2"
                                                          headerText="#{bundle.table_asignados_column_header_atributo}"/>
                                                <p:column colspan="2" id="campoPersona">
                                                    <f:facet name="header">
                                                        <h:outputText
                                                                value="#{bundle.table_asignados_column_header_campo_persona}"/>
                                                        <p:tooltip value="#{bundle.table_column_tooltip_campo_persona}"
                                                                   for="campoPersona"
                                                                   position="top"/>
                                                    </f:facet>
                                                </p:column>
                                                <p:column/>
                                            </p:row>
                                        </p:columnGroup>

                                        <p:column>
                                            <h:outputText value="#{atribute.atributoFichero}"/>
                                        </p:column>

                                        <p:column>
                                            <h:outputText
                                                    value="#{stepUtils.getClassByAtribute(atribute.atributoFichero)}"/>
                                        </p:column>

                                        <p:column>
                                            <p:cellEditor>
                                                <f:facet name="output">
                                                    <h:outputText value="#{atribute.atributoPersona}"/>
                                                </f:facet>
                                                <f:facet name="input">
                                                    <p:selectOneMenu id="selectOneAtr"
                                                                     value="#{atribute.atributoPersona}"
                                                                     style="width:100%"
                                                    >
                                                        <f:selectItem itemLabel="#{bundle.label_select_one_atribute}"
                                                                      itemValue=""/>
                                                        <f:selectItems
                                                                value="#{stepSelectPersonController.getPersonAtributes()}"
                                                                var="atrP"
                                                                itemValue="#{atrP}"
                                                                itemLabel="#{atrP}"
                                                        />
                                                        <p:ajax update="@all"/>
                                                    </p:selectOneMenu>
                                                </f:facet>
                                            </p:cellEditor>
                                        </p:column>

                                        <p:column id="columnToUpdateP">
                                            <h:outputText value="#{stepSelectPersonController.
                                            getGetClassByPersonAtribute(atribute.atributoPersona)}"
                                            />
                                        </p:column>

                                        <p:column style="width:32px;text-align: center">
                                            <p:commandButton
                                                    actionListener="#{stepSelectPersonController.removeAtribute(atribute)}"
                                                    icon="ui-icon-delete"
                                                    update="@all"
                                            />
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>
                            </p:fieldset>

                            <p:droppable for="fldsetAsignadosP" tolerance="touch" activeStyleClass="ui-state-highlight"
                                         datasource="tableDisponibleP" onDrop="handleDrop">
                                <p:ajax listener="#{stepSelectPersonController.onDrop}"
                                        update="@all"/>
                            </p:droppable>
                        </div>
                    </div>
                </p:fieldset>
            </div>
        </div>
    </h:form>
</ui:composition>