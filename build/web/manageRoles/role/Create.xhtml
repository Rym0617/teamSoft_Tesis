<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/template/template.xhtml">

    <ui:define name="top">
        <p:breadCrumb>
            <p:menuitem value="Inicio" url="/index.jsf"/>
            <p:menuitem value="Roles" url="/manageRoles/role/List.jsf"/>
            <p:menuitem value="Crear" url="#"/>
        </p:breadCrumb>
    </ui:define>


    <ui:define name="body">
        <h:form id="RoleCreateForm">
            <div class="ui-g-12 ui-fluid">
                <p:fieldset legend="#{bundle.roleDataFieldet}">
                    <div class="md-inputfield">
                        <p:inputText id="roleName" value="#{roleController.selected.roleName}"
                                     title="#{bundle.CreateRoleTitle_roleName}" required="true"
                                     requiredMessage="#{bundle.CreateRoleRequiredMessage_roleName}"/>
                        <h:outputLabel value="#{bundle.CreateRoleLabel_roleName}" for="roleName"/>
                    </div>
                    <br/>
                    <div class="md-inputfield">
                        <p:inputTextarea id="roleDesc" rows="6" cols="33"
                                         autoResize="false" value="#{roleController.selected.roleDesc}" maxlength="300"
                                         counter="remainingChars"
                                         counterTemplate="{0} #{bundle.remainingChars}"
                                         required="true" requiredMessage="#{bundle.CreateRoleRequiredMessage_roleDesc}">
                        </p:inputTextarea>
                        <h:outputLabel value="#{bundle.CreateRoleLabel_roleDesc}" for="roleDesc"/>
                    </div>
                    <h:outputLabel id="remainingChars"/>

                    <div>
                        <br/>

                        <h:panelGrid columns="1" style="margin-bottom:10px">
                            <h:panelGrid columns="2" style="margin-bottom:10px">
                                <p:selectBooleanCheckbox id="isBoss"
                                                         value="#{roleController.selected.boss}"
                                                         disabled="#{roleController.disableCheckTeamLeader(false)}"
                                >
                                    <p:ajax process="@this" update="labelCheck"/>
                                </p:selectBooleanCheckbox>
                                <p:outputLabel id="labelCheck"
                                               value="#{bundle.team_leader}"
                                               for="isBoss"
                                               disabled="#{roleController.disableCheckTeamLeader(false)}"
                                />
                            </h:panelGrid>

                            <h:panelGrid columns="2" style="margin-bottom:10px">
                                <h:outputText id="output"
                                              value="#{bundle.CreateRoleLabel_impact}: #{roleController.selected.impact}"/>
                                <h:inputHidden id="impact" value="#{roleController.selected.impact}"/>
                                <p:slider for="impact" display="output" style="width: 200px"
                                          displayTemplate="#{bundle.CreateRoleLabel_impact}: {value}" maxValue="1"
                                          step="0.1"/>
                            </h:panelGrid>
                        </h:panelGrid>


                    </div>
                </p:fieldset>

                <br/>

                <p:tabView id="tabs" dynamic="true" cache="true">

                    <p:tab id="roleGenCompTab" title="#{bundle.roleGenCompetencesTab}">

                        <div class="ui-g-12">
                            <div>
                                <h:outputLabel for="genCompSelection" value="#{bundle.selectGenCompetitionHeader}"/>
                                <p:selectOneListbox id="genCompSelection"
                                                    value="#{roleCompetitionController.selected.competenceFk}"
                                                    disabled="#{empty myRoleController.genericCompetences}"
                                                    filter="true" filterMatchMode="contains">
                                    <f:selectItems value="#{myRoleController.genericCompetences}"
                                                   var="genCompSelectionItem" itemValue="#{genCompSelectionItem}"
                                                   itemLabel="- #{genCompSelectionItem.competitionName}"/>

                                    <p:ajax update="addGenCompButton,roleLvls"/>
                                </p:selectOneListbox>
                            </div>
                        </div>


                        <h:panelGroup id="roleLvls">

                            <div class="ui-g-6">
                                <h:outputLabel value="#{bundle.roleCompetenceMinLvl}" for="minLvl"/>
                                <p:selectOneMenu effect="clip" id="minLvl"
                                                 value="#{roleCompetitionController.selected.levelsFk}"
                                                 disabled="#{empty myRoleController.genericCompetences}" filter="true"
                                                 filterMatchMode="contains">
                                    <f:selectItem itemLabel="#{bundle.selectOnePlaceHolder}"/>
                                    <f:selectItems value="#{levelsController.itemsAvailableSelectOne}"
                                                   var="genCompLvlListItem"
                                                   itemValue="#{genCompLvlListItem}"
                                                   itemLabel="#{genCompLvlListItem.levels}->#{genCompLvlListItem.significance}"/>
                                    <p:ajax update="addGenCompButton"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="ui-g-6">
                                <h:outputLabel value="#{bundle.roleImportanceLvl}" for="importanceLvl"/>
                                <p:selectOneMenu effect="clip" id="importanceLvl"
                                                 value="#{roleCompetitionController.selected.compImportanceFk}"
                                                 disabled="#{empty myRoleController.genericCompetences}" filter="true"
                                                 filterMatchMode="contains">
                                    <f:selectItem itemLabel="#{bundle.selectOnePlaceHolder}"/>
                                    <f:selectItems value="#{competenceImportanceController.itemsAvailableSelectOne}"
                                                   var="competenceImportance"
                                                   itemValue="#{competenceImportance}"
                                                   itemLabel="#{competenceImportance.levels}->#{competenceImportance.significance}"/>
                                    <p:ajax update="addGenCompButton"/>
                                </p:selectOneMenu>
                            </div>
                            <br/>
                            <div>
                                <p:commandButton class="z-depth-1" id="addGenCompButton" icon="ui-icon-plus"
                                                 type="button" value="#{bundle.addSelectedWorkerCompetenceLevel}"
                                                 disabled="#{myRoleController.handleAddButton_Listener()}">
                                    <p:ajax event="click" update="genCompSelection,roleLvls,selectedGenComp"
                                            listener="#{myRoleController.addGenComp_Listener()}"/>
                                </p:commandButton>
                            </div>
                        </h:panelGroup>

                        <div>
                            <br/>
                            <p:dataTable id="selectedGenComp"
                                         value="#{myRoleController.roleCompetitionList}"
                                         editable="true"
                                         selection="#{myRoleController.roleCompetitionRemoveList}"
                                         style="margin-bottom:0"
                                         var="genCompTableSelection"
                                         rowKey="#{genCompTableSelection.competenceFk.id}"
                            >

                                <f:facet name="header">
                                    #{bundle.roleGenCompetencesTableHeader}
                                </f:facet>

                                <p:ajax event="rowSelect" update="deleteButton"/>
                                <p:ajax event="rowUnselect" update="deleteButton"/>
                                <p:ajax event="rowSelectCheckbox" update="deleteButton"/>
                                <p:ajax event="rowUnselectCheckbox" update="deleteButton"/>
                                <p:ajax event="toggleSelect" update="deleteButton"/>

                                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                                <p:column headerText="#{bundle.ListCompetenceTitle_competitionName}">
                                    #{genCompTableSelection.competenceFk.competitionName}
                                </p:column>

                                <p:column headerText="#{bundle.roleCompetenceMinLvl}">
                                    #{genCompTableSelection.levelsFk.levels}.#{genCompTableSelection.levelsFk.significance}
                                </p:column>
                                <p:column headerText="#{bundle.roleImportanceLvl}">
                                    #{genCompTableSelection.compImportanceFk.levels}.#{genCompTableSelection.compImportanceFk.significance}
                                </p:column>

                                <f:facet name="footer">
                                    <p:commandButton class="z-depth-1" id="deleteButton" type="button"
                                                     process="selectedGenComp" icon="ui-icon-trash"
                                                     value="#{bundle.quitSelectedCompetence}"
                                                     disabled="#{empty myRoleController.roleCompetitionRemoveList}">
                                        <p:ajax event="click"
                                                update="selectedGenComp,RoleCreateForm:tabs:genCompSelection"
                                                listener="#{myRoleController.removeGenCompFromTable_Listener()}"/>
                                    </p:commandButton>
                                </f:facet>
                            </p:dataTable>

                        </div>

                    </p:tab>

                    <p:tab id="roleIncompTab" title="#{bundle.rolIncompatibilities}">

                        <h:outputLabel for="incompatibilityMenu" value="#{bundle.rolIncompatibilitiesMenuLabel}"/>
                        <p:selectCheckboxMenu id="incompatibilityMenu" value="#{myRoleController.incompatibility}"
                                              label="#{bundle.selectOnePlaceHolder}"
                                              filter="true" filterMatchMode="startsWith" panelStyle="width:250px"
                                              converter="roleConverter" style="margin-bottom: 5px">
                            <f:selectItems var="rolItemVar" value="#{roleController.itemsAvailableSelectMany}"
                                           itemDescription="#{rolItemVar.roleDesc}" itemValue="#{rolItemVar}"
                                           itemLabel="#{rolItemVar.roleName}"/>
                            <p:ajax event="toggleSelect" update="incompatibilityTable"/>
                            <p:ajax event="change" update="incompatibilityTable"/>
                        </p:selectCheckboxMenu>

                        <p:dataTable id="incompatibilityTable" var="rolItem"
                                     value="#{myRoleController.incompatibility}">

                            <f:facet name="header">
                                #{bundle.roleIncompatibilityTableHeader}
                            </f:facet>

                            <p:column headerText="#{bundle.personalInterestsRoleTableHeader}">
                                <h:outputText value="#{rolItem.roleName}"/>
                            </p:column>

                            <p:column headerText="#{bundle.roleDescColumHeader}">
                                <h:outputText value="#{rolItem.roleDesc}"/>
                            </p:column>

                        </p:dataTable>

                    </p:tab>

                </p:tabView>

                <div>
                    <p:commandButton class="z-depth-1" actionListener="#{myRoleController.create()}"
                                     value="#{bundle.Save}" update="@form,:growl"/>
                    <p:commandButton class="z-depth-1" value="#{bundle.Cancel}" immediate="true" action="to-role-list"/>
                </div>

            </div>
        </h:form>


    </ui:define>
</ui:composition>
</html>
