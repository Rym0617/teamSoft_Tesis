<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<!--by jpinas-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core"
>
    <style>
        .foo > tbody > td {
            vertical-align: top;
        }
    </style>
    <p:panel>
        <h:form id="formVerifyData">
            <p:fieldset id="fieldContainer" toggleable="false"
                        styleClass="ui-noborder"> <!--esto pone un fondo blanco-->
                <p:panelGrid columns="3" styleClass="ui-noborder">
                    <p:outputLabel value="#{bundle.selected_group}" for="inputGrupo"/>
                    <p:inputText id="inputGrupo"
                                 value="#{stepVerifyData.selectedPersonGroup.name}"
                                 readonly="true"/>
                    <p:commandButton value="#{bundle.label_edit}"
                                     oncomplete="PF('wizard').loadStep('select-file',false)"/>
                </p:panelGrid>

                <p:fieldset id="fieldPers"
                            legend="#{bundle.label_persona}"
                            toggleable="true" toggleSpeed="500"
                >
                    <p:panelGrid columns="1" id="panelPersonas" styleClass="ui-noborder">
                        <p:dataTable id="tableSelectedP" var="atribute"
                                     value="#{stepVerifyData.atributosPersona}"
                                     reflow="true"
                        >
                            <f:facet name="header">
                                <p:outputLabel value="#{bundle.table_asignados_header}"/>
                            </f:facet>

                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column colspan="2"
                                              headerText="#{bundle.table_asignados_column_header_atributo}"/>
                                    <p:column colspan="2" id="campoPersona">
                                        <f:facet name="header">
                                            <h:outputText
                                                    value="#{bundle.table_asignados_column_header_campo_persona}"/>
                                            <p:tooltip value="#{bundle.table_column_tooltip_campo_persona}"
                                                       for="campoPersona"
                                                       position="top"/>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>

                            <p:column>
                                <h:outputText value="#{atribute.atributoFichero}"/>
                            </p:column>

                            <p:column>
                                <h:outputText
                                        value="#{stepUtils.getClassByAtribute(atribute.atributoFichero)}"/>
                            </p:column>

                            <p:column>
                                <p:outputLabel value="#{atribute.atributoPersona}"/>
                            </p:column>

                            <p:column id="columnToUpdateP">
                                <p:outputLabel value="#{stepSelectPersonController.
                                                getGetClassByPersonAtribute(atribute.atributoPersona)}"
                                />
                            </p:column>

                            <f:facet name="footer">
                                <p:commandButton class="z-depth-1" value="#{bundle.label_edit}"
                                                 oncomplete="PF('wizard').loadStep('select-person',false)"/>
                            </f:facet>
                        </p:dataTable>
                    </p:panelGrid>
                </p:fieldset>

                <p:fieldset id="fieldRol"
                            legend="#{bundle.label_rol}"
                            toggleable="true" toggleSpeed="500"
                            collapsed="true"
                >
                    <p:panelGrid columns="1" id="panelRoles" styleClass="ui-noborder">
                        <p:dataTable id="tableSelectedR" var="atributeRole"
                                     value="#{stepVerifyData.atributosRoles}"
                                     reflow="true"
                        >
                            <f:facet name="header">
                                <p:outputLabel value="#{bundle.table_rolesAsignados_header}"/>
                            </f:facet>

                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column colspan="2"
                                              headerText="#{bundle.table_asignados_column_header_atributo}"/>
                                    <p:column id="campoRol">
                                        <f:facet name="header">
                                            <h:outputText
                                                    value="#{bundle.label_role}"/>
                                            <p:tooltip
                                                    value="#{bundle.table_column_tooltip_campo_competencia}"
                                                    for="campoRol"
                                                    position="top"/>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>

                            <p:column>
                                <h:outputText value="#{atributeRole.fileAtribute}"/>
                            </p:column>

                            <p:column>
                                <h:outputText
                                        value="#{stepUtils.getClassByAtribute(atributeRole.fileAtribute)}"/>
                            </p:column>

                            <p:column>
                                <p:outputLabel value="#{atributeRole.getRoleName()}"/>
                            </p:column>

                            <f:facet name="footer">
                                <p:commandButton class="z-depth-1" value="#{bundle.label_edit}"
                                                 oncomplete="PF('wizard').loadStep('select-role',false)"/>
                            </f:facet>
                        </p:dataTable>
                    </p:panelGrid>
                </p:fieldset>

                <p:fieldset id="fieldComp"
                            legend="#{bundle.label_competencias}"
                            toggleable="true" toggleSpeed="500"
                            collapsed="true"
                >
                    <p:panelGrid columns="1" id="panelCompetencias" styleClass="ui-noborder">
                        <p:dataTable id="tableSelectedC" var="atributeComp"
                                     value="#{stepVerifyData.atributosCompetencias}"
                                     reflow="true"
                        >
                            <f:facet name="header">
                                <p:outputLabel value="#{bundle.table_asignados_header_competencias}"/>
                            </f:facet>

                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column colspan="2"
                                              headerText="#{bundle.table_asignados_column_header_atributo}"/>
                                    <p:column id="campoCompetencia">
                                        <f:facet name="header">
                                            <h:outputText
                                                    value="#{bundle.competence_type}"/>
                                            <p:tooltip value="#{bundle.table_column_tooltip_campo_competencia}"
                                                       for="campoCompetencia"
                                                       position="top"/>
                                        </f:facet>
                                    </p:column>
                                </p:row>
                            </p:columnGroup>

                            <p:column>
                                <h:outputText value="#{atributeComp.fileAtribute}"/>
                            </p:column>

                            <p:column>
                                <h:outputText
                                        value="#{stepUtils.getClassByAtribute(atributeComp.fileAtribute)}"/>
                            </p:column>

                            <p:column>
                                <p:selectOneMenu id="car">
                                    <f:selectItems value="#{stepVerifyData.atributosCompetencias.get(
                                                                              stepVerifyData.atributosCompetencias.indexOf(atributeComp)
                                                        ).competences}"/>
                                </p:selectOneMenu>
                            </p:column>

                            <f:facet name="footer">
                                <p:commandButton class="z-depth-1" value="#{bundle.label_edit}"
                                                 oncomplete="PF('wizard').loadStep('select-competence',false)"/>
                            </f:facet>

                        </p:dataTable>
                    </p:panelGrid>

                    <p:fieldset id="fieldCompConf"
                                legend="#{bundle.label_config}"
                                toggleable="true" toggleSpeed="500"
                                collapsed="true"
                    >
                        <p:panelGrid columns="3" styleClass="ui-noborder foo">
                            <p:panelGrid columns="1" cellpadding="2">
                                <p:panelGrid columns="2" cellpadding="5">
                                    <p:outputLabel for="comboTexto"
                                                   rendered="#{not empty stepConfCompetences.getKeysOfTextAtributes()}"
                                                   value="#{bundle.label_atributo_texto}"
                                    />
                                    <p:selectOneMenu id="comboTexto"
                                                     value="#{stepConfCompetences.selectedAssignedText}"
                                                     style="width:100%"
                                                     rendered="#{not empty stepConfCompetences.getKeysOfTextAtributes()}"
                                    >
                                        <f:selectItems
                                                value="#{stepConfCompetences.getKeysOfTextAtributes()}"
                                                var="atrC"
                                                itemLabel="#{atrC}"
                                                itemValue="#{atrC}"
                                        />
                                        <p:ajax event="change"
                                                update="tableSelectedTexto"
                                        />
                                    </p:selectOneMenu>
                                </p:panelGrid>

                                <p:dataTable id="tableSelectedTexto" var="assignedText"
                                             value="#{stepConfCompetences.getValuesOfSelectedText(
                                         stepConfCompetences.selectedAssignedText
                                         )}"
                                             rendered="#{not empty stepConfCompetences.getKeysOfTextAtributes()}"
                                             reflow="true"
                                >
                                    <f:facet name="header">
                                        <p:outputLabel value="#{bundle.table_text_value_header}"/>
                                    </f:facet>

                                    <p:columnGroup type="header">
                                        <p:row>
                                            <p:column
                                                    headerText="#{bundle.table_asignados_column_header_atributo}"
                                            />
<!--                                            <p:column headerText="peso"/>-->
                                        </p:row>
                                    </p:columnGroup>

                                    <p:column>
                                        <h:outputText value="#{assignedText.valorDentroFichero}"/>
                                    </p:column>

<!--                                    <p:column id="colPeso">-->
<!--                                        <h:outputText-->
<!--                                                value="#{assignedText.peso}" id="output1"/>-->
<!--                                    </p:column>-->

<!--                                    <p:columnGroup type="footer">-->
<!--                                        <p:row>-->
<!--                                            <p:column footerText="#{bundle.label_suma_total}"-->
<!--                                                      style="text-align:right"/>-->
<!--                                            <p:column-->
<!--                                                    footerText="#{stepConfCompetences.getSumOfValuesCompetenceTexto()}"-->
<!--                                                    style="text-align: center"/>-->
<!--                                        </p:row>-->
<!--                                    </p:columnGroup>-->

                                    <f:facet name="footer">
                                        <p:commandButton class="z-depth-1" value="#{bundle.label_edit}"
                                                         oncomplete="PF('wizard').loadStep('config-competences',false)"/>
                                    </f:facet>

                                </p:dataTable>
                            </p:panelGrid>

                            <p:panelGrid columns="1" cellpadding="2">
                                <p:panelGrid columns="2" cellpadding="5">
                                    <p:outputLabel for="comboCompValue"
                                                   value="#{bundle.competences_more_one_value}"
                                                   rendered="#{not empty stepConfCompetences.getKeysOfCompetence()}"
                                    />
                                    <p:selectOneMenu id="comboCompValue"
                                                     value="#{stepConfCompetences.selectedCompetence}"
                                                     style="width:100%"
                                                     rendered="#{not empty stepConfCompetences.getKeysOfCompetence()}"
                                    >
                                        <f:selectItems
                                                value="#{stepConfCompetences.getKeysOfCompetence()}"
                                                var="compVal"
                                                itemLabel="#{compVal}"
                                                itemValue="#{compVal}"
                                        />
                                        <p:ajax event="change"
                                                update="tableCompetenceAtrValue"
                                        />
                                    </p:selectOneMenu>
                                </p:panelGrid>

                                <p:dataTable id="tableCompetenceAtrValue" var="compAtr"
                                             value="#{stepConfCompetences.getValuesOfSelectedCompetence(
                                                                         stepConfCompetences.selectedCompetence
                                                                         )}"
                                             reflow="true"
                                             rendered="#{not empty stepConfCompetences.getKeysOfCompetence()}"
                                >
                                    <f:facet name="header">
                                        <p:outputLabel value="#{bundle.table_text_value_header}"/>
                                    </f:facet>

                                    <p:columnGroup type="header">
                                        <p:row>
                                            <p:column
                                                    headerText="#{bundle.table_asignados_column_header_atributo}"
                                            />
                                            <p:column id="valorCompAtr">
                                                <f:facet name="header">
                                                    <h:outputText
                                                            value="#{bundle.label_peso}"/>
                                                    <p:tooltip value="#{bundle.table_column_tooltip_campo_persona}"
                                                               for="valorCompAtr"
                                                               position="top"/>
                                                </f:facet>
                                            </p:column>
                                        </p:row>
                                    </p:columnGroup>

                                    <p:column>
                                        <h:outputText value="#{compAtr.atributo}"/>
                                    </p:column>

                                    <p:column id="colPesoAtr">
                                        <h:outputText
                                                value="#{compAtr.peso}" id="outputAtr"/>
                                    </p:column>

                                    <p:columnGroup type="footer">
                                        <p:row>
                                            <p:column footerText="#{bundle.label_suma_total}"
                                                      style="text-align:right"/>
                                            <p:column
                                                    footerText="#{stepConfCompetences.getSumOfValuesCompetenceAtr()}"
                                                    style="text-align: center"/>
                                        </p:row>
                                    </p:columnGroup>

                                    <f:facet name="footer">
                                        <p:commandButton class="z-depth-1" value="#{bundle.label_edit}"
                                                         oncomplete="PF('wizard').loadStep('config-competences',false)"/>
                                    </f:facet>
                                </p:dataTable>
                            </p:panelGrid>

                            <p:panelGrid columns="1" cellpadding="5">
                                <p:outputLabel
                                        rendered="#{not empty stepConfCompetences.getAtributosAsignadosNumero()}"
                                        value="#{bundle.max_valor_numerico}"
                                />

                                <p:dataTable id="tableAtrNum" var="atrValue"
                                             value="#{stepConfCompetences.atributosAsignadosNumero}"
                                             reflow="true"
                                             rendered="#{not empty stepConfCompetences.getAtributosAsignadosNumero()}"
                                >
                                    <f:facet name="header">
                                        <p:outputLabel value="#{bundle.table_text_value_header}"/>
                                    </f:facet>

                                    <p:columnGroup type="header">
                                        <p:row>
                                            <p:column headerText="#{bundle.table_disponibles_column_header}"/>
                                            <p:column id="valorAtrMax">
                                                <f:facet name="header">
                                                    <h:outputText value="#{bundle.max_value}"/>
                                                    <p:tooltip value="#{bundle.tooltip_max_value}"
                                                               for="valorAtrMax"
                                                               position="top"/>
                                                </f:facet>
                                            </p:column>
                                        </p:row>
                                    </p:columnGroup>

                                    <p:column>
                                        <h:outputText value="#{atrValue.fileAtribute}"/>
                                    </p:column>

                                    <p:column id="colPesoMaxValAtr">
                                        <h:outputText id="labelValor"
                                                      value="#{atrValue.maximoValor}"/>
                                    </p:column>

                                    <f:facet name="footer">
                                        <p:commandButton class="z-depth-1" value="#{bundle.label_edit}"
                                                         oncomplete="PF('wizard').loadStep('config-competences',false)"/>
                                    </f:facet>
                                </p:dataTable>
                            </p:panelGrid>
                        </p:panelGrid>
                    </p:fieldset>
                </p:fieldset>
            </p:fieldset>
        </h:form>
        <p:commandButton value="#{bundle.label_importar}"
                         actionListener="#{importarController.actionBtnImportar()}"
        />
    </p:panel>

    <p:dialog header="#{bundle.label_information}" widgetVar="dialogMessage" dynamic="true" modal="true" height="50">
        <p:ajax event="close" listener="#{importarController.redirectToFirstStep()}"/>
        <h:outputText id="text" value="#{importarController.getMensajeDespuesImportar()}"/>
    </p:dialog>
</ui:composition>